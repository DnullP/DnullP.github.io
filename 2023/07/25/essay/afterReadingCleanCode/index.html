

<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <title>Clean Code阅读笔记 [ Dnull_P Welcome~ ]</title>
  
  <!-- stylesheets list from _config.yml -->
  
  <link rel="stylesheet" href="/css/Genso.css">
  
  <link rel="stylesheet" href="/css/layout/layout.css">
  
  <link rel="stylesheet" href="/css/layout/navigator.css">
  
  <link rel="stylesheet" href="/css/layout/page-container.css">
  
  <link rel="stylesheet" href="/css/layout/page-cover.css">
  
  <link rel="stylesheet" href="/css/layout/slidebar.css">
  
  <link rel="stylesheet" href="/css/index/index.css">
  
  <link rel="stylesheet" href="/css/index/recommend-card-container.css">
  
  <link rel="stylesheet" href="/css/index/card-container.css">
  
  <link rel="stylesheet" href="/css/index/card.css">
  
  <link rel="stylesheet" href="/css/post/post.css">
  
  <link rel="stylesheet" href="/css/post/idea.css">
  
  <link rel="stylesheet" href="/css/tool/color.css">
  
  
  <script>
    const urlList = ('https://s2.loli.net/2023/07/23/mivfcl7wqgVsYdP.jpg,https://s2.loli.net/2023/07/23/E3uyek7OVlJgtLT.jpg,https://s2.loli.net/2023/07/23/q9skN6cPAZ14fwH.png,https://s2.loli.net/2023/07/23/RedmkprBY81ZhaV.jpg,https://s2.loli.net/2023/07/23/pt1ArR7NqO8vMXl.png,https://s2.loli.net/2023/07/23/MZEW5UCFSBPiNvH.png,https://s2.loli.net/2023/07/23/8urpklSmq6xR5LF.jpg,https://s2.loli.net/2023/07/23/E6Os9tkrRP4FZ7f.jpg,https://s2.loli.net/2023/07/23/IPq4HsZCOfTMGxk.jpg,https://s2.loli.net/2023/07/23/sAhIbjyLeMBgfuw.jpg,https://s2.loli.net/2023/07/23/ipTsxHoDOawRrfM.png,https://s2.loli.net/2023/07/23/eTYKcWz7jb5mqyo.png,https://s2.loli.net/2023/07/23/lHLk3OMeY7qXnTP.jpg,https://s2.loli.net/2023/07/23/u9dvATztknGecmI.jpg,https://s2.loli.net/2023/07/23/calWvPZEbI9tG4o.png,https://s2.loli.net/2023/07/23/MLZr1j7hdDnIHGU.png,https://s2.loli.net/2023/07/23/PlqeV1XpgQrxI8u.jpg,https://s2.loli.net/2023/07/23/uWQXFEBh5iCcNJV.png,https://s2.loli.net/2023/07/23/xjcUksAMvHQVhim.jpg,https://s2.loli.net/2023/07/23/Bd46rfJ2HYhQGkM.jpg,https://s2.loli.net/2023/07/23/1BgtkI3Aw58qrGv.jpg,https://s2.loli.net/2023/07/23/z8naFUvWV7BfKud.jpg,https://s2.loli.net/2023/07/23/Xj4wlzuKTDQOmHh.png,https://s2.loli.net/2023/07/23/mKzLHqPkUWTivAu.png,https://s2.loli.net/2023/07/23/a36bWlVynziMrSU.jpg,https://s2.loli.net/2023/07/23/6ZNUeJAtDCRvWq8.jpg,https://s2.loli.net/2023/07/23/7nGYxgcyoi8aSIR.jpg,https://s2.loli.net/2023/07/23/EVeCvBAt1LOgJSU.jpg,https://s2.loli.net/2023/07/23/onE5MQBPGdzDROh.jpg,https://s2.loli.net/2023/07/23/316kgDancGthANM.jpg,https://s2.loli.net/2023/07/23/oeRXvLm5byqgazF.jpg,https://s2.loli.net/2023/07/23/HXj7NsSW5vyCoIn.jpg,https://s2.loli.net/2023/07/23/sqM2XznWeEol3f4.jpg,https://s2.loli.net/2023/07/23/xGAflC5roSOsJRz.jpg,https://s2.loli.net/2023/07/23/cF2oWANXImMREKx.jpg,https://s2.loli.net/2023/07/23/IqutSTML7EXRza3.jpg,https://s2.loli.net/2023/07/23/zYNG9XHIEfg4quh.png').split(',');
  </script>

<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div class="background">
  

  <img src="https://s2.loli.net/2023/07/23/mKzLHqPkUWTivAu.png" alt="">

  <div class="title-text animate__animated animate__bounce">
    <h1>This is
      <span class="name">
        Dnull_P
      </span>
    </h1>
    Welcome Hell !

  </div>
</div>

<div class="background-coverage">
  <!--Typed text-->
  <div class="background-coverage-text">
    <span id="background-coverage-text">
    </span>
  </div>
</div>

<div class="background-occupation">

</div>

  <div class="navigator">
  <div class="navi-buttom-container">
    
    
  <a href="/" class="navi-buttom">
    <div>
      Home
    </div>
  </a>
  
  
    
  <a href="/about" class="navi-buttom">
    <div>
      About
    </div>
  </a>
  
  
    
  <a href="/contact" class="navi-buttom">
    <div>
      Contact
    </div>
  </a>
  
  
    
    <div class="navi-dropdown">
      <div class="dropbtn">
        post
      </div>
      <div class="dropdown-content">
        
        <a href="/archives">
          Aarchives
        </a>
        
        <a href="/tags">
          Tags
        </a>
        
      </div>
    </div>
  </div>
  
  
</div>

  <div class="page-container">
    <div class="slidebar-warp">
  <div class="slidebar">
    <div class="panel">

      <div class="avatar">
        <img src="/pic/avatar.jpg" alt="">
      </div>

      <div class="info">
        <div class="subinfo-1">
          <div class="subinfo-1-left">
            <div class="subinfo-1-left-info">
              <div class="subinfo-1-left-info-inner">
                <div class="subinfo-1-left-info-front">
                  Post
                </div>
                <div class="subinfo-1-left-info-back random-color">
                  156
                </div>
              </div>
            </div>

            <div class="subinfo-1-left-info">
              <div class="subinfo-1-left-info-inner">
                <div class="subinfo-1-left-info-front">
                  Cate
                </div>
                <div class="subinfo-1-left-info-back random-color">
                  37
                </div>
              </div>
            </div>

            <div class="subinfo-1-left-info">
              <div class="subinfo-1-left-info-inner">
                <div class="subinfo-1-left-info-front">
                  Tag
                </div>
                <div class="subinfo-1-left-info-back random-color">
                  191
                </div>
              </div>
            </div>

          </div>

          <div class="subinfo-1-right">
            <div class="subinfo-1-right-inner">
              <div class="subinfo-1-right-front">
                This Month
              </div>
              <div class="subinfo-1-right-back random-color">
                2
              </div>
            </div>
          </div>
        </div>

        <div class="subinfo-2-wrap">
          <div class="subinfo-2">

            
            <div class="sociallink">
    <a href=https://github.com/DnullP>
      <img src="/svg/github.svg" alt="">
    </a>
</div>
            

          </div>
        </div>
      </div>

      <div class="more-opt">

      </div>

    </div>

    <div class="icon-warp">


      <button class="hide-slidebar-button">
        <img src="/svg/arrow-right-line.svg" id="slideBarArrow">
      </button>


    </div>
  </div>
</div>

    <div class="content">
      <div class="post">
  <h1>Clean Code阅读笔记</h1>
  <p><em>Clean Code</em> called 《代码整洁之道》in Chinese give a lot of guidance on how to write readable code. </p>
<p>在此为此书的阅读做出整理</p>
<hr>
<!-- TOC -->

<ul>
<li><a href="#%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86">第一部分</a><ul>
<li><a href="#%E6%A0%BC%E5%BC%8Fformat%E9%83%A8%E5%88%86">格式(format)部分</a><ul>
<li><a href="#vertical-formatting">vertical formatting</a></li>
<li><a href="#horizontal-formatting">horizontal formatting</a></li>
</ul>
</li>
<li><a href="#intermission">intermission</a></li>
</ul>
</li>
<li><a href="#%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86">第二部分</a><ul>
<li><a href="#%E5%AF%B9%E8%B1%A1%E5%92%8C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">对象和数据结构</a><ul>
<li><a href="#%E6%95%B0%E6%8D%AE%E7%9A%84%E6%8A%BD%E8%B1%A1">数据的抽象</a></li>
<li><a href="#%E5%8F%8D%E5%AF%B9%E7%A7%B0%E6%80%A7">反对称性</a></li>
<li><a href="#%E8%BF%AA%E7%B1%B3%E7%89%B9%E5%8E%9F%E5%88%99">迪米特原则</a></li>
<li><a href="#%E5%AF%B9%E8%B1%A1%E5%92%8C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-1">对象和数据结构</a></li>
</ul>
</li>
<li><a href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86">错误处理</a></li>
<li><a href="#%E8%BE%B9%E7%95%8Cboundary">边界(boundary)</a></li>
<li><a href="#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95">单元测试</a><ul>
<li><a href="#ttdtest-driven-development">TTD(Test-Driven Development)</a></li>
<li><a href="#clean-test">clean test</a></li>
</ul>
</li>
<li><a href="#class">Class</a><ul>
<li><a href="#small-enough">Small Enough!</a></li>
<li><a href="#organizing-for-change">Organizing for Change</a></li>
</ul>
</li>
<li><a href="#system">System</a><ul>
<li><a href="#%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5">依赖注入</a></li>
<li><a href="#ioc">Ioc</a></li>
<li><a href="#aop">AOP</a></li>
<li><a href="#test-drive-the-archithecture">Test drive the Archithecture</a></li>
<li><a href="#%E5%81%9A%E5%87%BA%E6%9B%B4%E5%A5%BD%E7%9A%84%E5%86%B3%E5%AE%9A">做出更好的决定</a></li>
<li><a href="#%E7%90%86%E6%80%A7%E5%AF%B9%E5%BE%85%E6%A0%87%E5%87%86">理性对待<em>标准</em></a></li>
<li><a href="#%E4%BD%BF%E7%94%A8dsldomain-specific-language">使用DSL(Domain Specific Language)</a></li>
</ul>
</li>
<li><a href="#emergence">Emergence</a><ul>
<li><a href="#emergent-design">Emergent Design</a></li>
</ul>
</li>
<li><a href="#concurrency">Concurrency</a><ul>
<li><a href="#srp-in-conccurrency">SRP in Conccurrency</a></li>
<li><a href="#%E5%87%8F%E5%B0%91%E5%85%B1%E4%BA%AB%E6%95%B0%E6%8D%AE-%E7%BC%A9%E5%B0%8F%E6%95%B0%E6%8D%AEscope">减少共享数据, 缩小数据scope</a></li>
<li><a href="#%E5%B0%BD%E9%87%8F%E7%8B%AC%E7%AB%8B">尽量独立</a></li>
<li><a href="#excution-models">Excution Models</a><ul>
<li><a href="#produceer-consumer">Produceer-Consumer</a></li>
<li><a href="#readers-writers">Readers-Writers</a></li>
<li><a href="#dining-philosophers">Dining Philosophers</a></li>
</ul>
</li>
<li><a href="#synchronized-method">Synchronized Method</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86">第三部分</a></li>
</ul>
<!-- /TOC -->
<!-- /TOC -->
<!-- /TOC -->
<!-- /TOC -->
<!-- /TOC -->
<!-- /TOC -->
<!-- /TOC -->
<!-- /TOC -->
<!-- /TOC -->
<!-- /TOC -->
<!-- /TOC -->
<!-- /TOC -->
<!-- /TOC -->
<!-- /TOC -->
<!-- /TOC -->
<!-- /TOC -->
<!-- /TOC -->
<!-- /TOC -->
<!-- /TOC -->
<!-- /TOC -->

<hr>
<h1 id="第一部分"><a href="#第一部分" class="headerlink" title="第一部分"></a>第一部分</h1><p>这一部分以代码提供有效的信息和组织代码以优化信息为主.</p>
<ul>
<li><p>给变量取名字要清晰，避免多个名字的混淆，这对于英语词汇量的要求会很高</p>
</li>
<li><p>函数的取名最好用动词，用来描述函数的行为，如果能够给出一个好命名的话, 只需要看函数和变量命名就能知道代码的行为, 我们认为这是好代码</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">// bad</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token function">getThem</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> list1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> x <span class="token operator">:</span> theList<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span>
            list1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> list1<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// good</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> <span class="token function">getFlaggedCells</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> flaggedCells <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cell <span class="token operator">:</span> gameBoard<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>cell<span class="token punctuation">[</span><span class="token constant">STATUS_VALUE</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token constant">FLAGGED</span><span class="token punctuation">)</span>
            flaggedCells<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>cell<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> flaggedCells<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre><p>  没有人知道<code>getThem</code>到底是想要得到什么, <code>list1</code>也只是让人知道这是个列表, 想要理解代码逻辑必须仔细阅读才行<br>  如果按照下面的代码命名, 我们能够一眼看出函数的作用: 得到被标记的格子. 然后我们可以看出代码是在从棋盘上遍历所有格子, 然后检查各自的状态, 并将标记的各自取出返回<br>  代码就像是在”tell a story”, 能够通过阅读理解, 而不是分析理解</p>
</li>
</ul>
<p>&emsp;</p>
<ul>
<li><p>函数和变量的命名可以形成动宾结构, 对象和成员函数的命名可以形成主谓结构, 遵守这样的原则可以让代码更加清晰</p>
<pre class="language-" data-language=""><code class="language-">targetStudent.isGirl();
targetStudent.setScore(100);

targetClass.deleteStudent(targetStudent);</code></pre><p>这样的代码即便我们不去阅读class的源码, 也能够一眼看出代码的作用</p>
<p>实际上我们此处的代码应该更加简化 [^1]</p>
</li>
</ul>
<p>[^1]: 这里的<code>targetClass.deleteStudent(targetStudent);</code>实际上可以简化为<code>targetClass.delete(targetStudent);</code>因为Class和Student实际上存在着一种潜在的必然关系, 并且我们的参数命名也应该提供足够的信息, 来明确此处要删除的是Student, 所以在函数名中再强调删除对象是多余的</p>
<p>&emsp;</p>
<ul>
<li>为了尽量维护动宾结构和主谓结构, 我们函数的参数最好不要超过两个参数 (可变参数除外), 三个参数的函数我们认为已经是极其糟糕的结构了<br>一个函数只要负责一个功能就行了, 最理想的情况是每个函数总行数不超过5行, 除非函数需要实现高聚合度的复杂功能<br>对于一些情况, 需要完成某些功能确实需要大量的参数设定时, 不要局限于用一个函数来实现. 比如我们要实现一个http的request, 我们需要设定url, header, timeout等参数信息, 使用一个函数来实现就十分的不优雅.<br>具体的, 我们对于一个request编写一个class, 将参数设定为成员变量, 然后针对每一个参数编写设置函数, 最后编写一个<code>send</code>函数来发送请求, 这样的代码就十分的优雅了, 这种设计模式我们称为<strong>建造者</strong>模式</li>
</ul>
<p>&emsp;</p>
<ul>
<li><p>注释不是必要的, 我们需要达到的至高境界是, 能够只通过函数和变量的命名, 就能够把代码的含义表述清楚</p>
</li>
<li><p>上面一条不是你不写注释的理由, 相信我, 你的代码写不到这么好</p>
</li>
<li><p>下面是一些通过注释写明的信息:</p>
<ul>
<li>合法信息: 包括了代码的作者, 版权信息, 代码的版本号等</li>
<li>对于复杂内容的阐明: 我们不能保证代码中所有内容都能通过函数和变量名表述清楚, 比如我在一处使用了正则表达式匹配, 正则表达式本身的可读性是很差的, 所以我或许需要用注释来阐明一下它的含义和匹配对象</li>
<li>TODO注释: 用来标记一些未完成的工作, 以及一些需要改进的地方</li>
</ul>
</li>
<li><p>阐明代码意图和解释模糊代码, 这是弥补代码不足的方式</p>
</li>
<li><p>对于一段代码, 如果需要警告用户一些重要的使用规则, 那么使用注释是没问题的, 比如对于一个计算函数:</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">//WARNING: totalAmount can't be zero</span>
<span class="token keyword">double</span> <span class="token function">calTheUtilization</span><span class="token punctuation">(</span><span class="token keyword">int</span> usedAmount<span class="token punctuation">,</span> <span class="token keyword">int</span> totalAmount<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>usedAmount <span class="token operator">/</span> totalAmount<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre><p>提示用户参数的使用限制, 这是一个合理的注释使用</p>
</li>
<li><p>对每一个参数都做注释并不是必要的, 但是对于一些规范的库而言, 给与尽可能详细的注释是有必要的</p>
</li>
<li><p>现在的IDE一般会提供良好的注释辅助, 将函数, class, 参数的注释直接显示给用户, 也提供了引用查找之类的便捷功能, 所以一些旧时代遗留下来注释习惯我们往往不必去在意</p>
</li>
</ul>
<h2 id="格式-format-部分"><a href="#格式-format-部分" class="headerlink" title="格式(format)部分"></a>格式(format)部分</h2><h3 id="vertical-formatting"><a href="#vertical-formatting" class="headerlink" title="vertical formatting"></a>vertical formatting</h3><ul>
<li>适当的空行, 以分割代码逻辑</li>
<li>控制垂直密度, 过高密度降低可读性</li>
<li>控制垂直距离, 减少被调用代码和调用代码的距离, 相近概念的代码放在一起</li>
<li>排列垂直顺序, 被调用者在调用者后面, 主要逻辑在细微逻辑后面, 把代码的主要内容放在最前面</li>
</ul>
<h3 id="horizontal-formatting"><a href="#horizontal-formatting" class="headerlink" title="horizontal formatting"></a>horizontal formatting</h3><ul>
<li>横线的信息密度由类似链式调用的代码提供, 我们需要控制横向代码的密度</li>
<li>横向对齐</li>
</ul>
<hr>
<h2 id="intermission"><a href="#intermission" class="headerlink" title="intermission"></a>intermission</h2><p>到这里为止的五章可以归类为第一部分, 这一部分强调的是代码本身为程序员提供信息理解的这一部分.</p>
<p>变量和函数的命名提供了信息, format为信息提供了组织形式, 注释为信息提供了补充.<br>所有这些要素一起协作为我们提供了理解代码的基本信息, 优秀的代码凭借这些基本原则可以提供很高的可读性.</p>
<hr>
<h1 id="第二部分"><a href="#第二部分" class="headerlink" title="第二部分"></a>第二部分</h1><p>这一部分以设计模式和设计原则为主</p>
<h2 id="对象和数据结构"><a href="#对象和数据结构" class="headerlink" title="对象和数据结构"></a>对象和数据结构</h2><h3 id="数据的抽象"><a href="#数据的抽象" class="headerlink" title="数据的抽象"></a>数据的抽象</h3><p>我们将数据设置为private, 通过函数的方式让外界来获取数据, 这样能够将数据的真实情况抽象出来, 让user不关注于数据的具体实现.</p>
<p>具体来说, 我们可以使用<code>x, y</code>表示笛卡尔坐标系的一个点, 但是我们获取数据时完全可以使用polar coordinates的方式获得坐标点, 尽管底层实际是<code>x, y</code></p>
<h3 id="反对称性"><a href="#反对称性" class="headerlink" title="反对称性"></a>反对称性</h3><p>尽管我们一般使用将数据抽象出来的方式, 以OPP的思想来实现数据的获取, 但是实际上将数据暴露出来, 通过一个过程来获得其数据也不是没有不可取之处.</p>
<p>考虑如下的情况:</p>
<div class="mermaid">classDiagram
  class Shape{
    +auto somedata
    +getArea()
    +getPerimeter()
  }
  class Rectangle{
    +auto somedata
  }
  class Circle{
    +auto somedata
    +getRadius()
  }
  Shape <|-- Rectangle
  Shape <|-- Circle</div><p>此时如果我们需要给Shape添加新的功能, 比如获取图形的<code>metadata</code>, 那么新的函数需要所有的class都做出修改才能实现</p>
<p>如果是将数据暴露出来, 使用一个公共过程的话, 我们就可以不对储存数据的结构做出任何修改, 只用修改管理函数的一个类即可:</p>
<div class="mermaid">classDiagram
  class Shape{
    +auto somedata
  }
  class Rectangle{
    +auto somedata
  }
  class Circle{
    +auto somedata
  }
  Shape <|-- Rectangle
  Shape <|-- Circle

  class Method{
    +getArea(Shape)
    +getPerimeter(Shape)
    +getRadius(Shape)
  }

  Shape --> Method</div><h3 id="迪米特原则"><a href="#迪米特原则" class="headerlink" title="迪米特原则"></a>迪米特原则</h3><blockquote>
<p>只与你的直接朋友交谈, 不要和陌生人说话</p>
</blockquote>
<p>也就是说一个类<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span>中的函数<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span>只应该调用以下的其他函数或变量:</p>
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span>本身</li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span>自己创建的对象</li>
<li>作为参数传递给<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span>的对象</li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span>的成员</li>
</ul>
<p>此原则的最终目的是<strong>低耦合, 高内聚</strong></p>
<h3 id="对象和数据结构-1"><a href="#对象和数据结构-1" class="headerlink" title="对象和数据结构"></a>对象和数据结构</h3><p>对象是隐藏内部, 只展示operation的, 而数据结构暴露内部数据, 而提供很少的对外行为</p>
<p>对于只提供数据的存在, 我们使用结构来实现, 而如果我们需要实现某种行为, 我们需要考虑对象, 并且遵守<strong>低耦合高内聚</strong>的原则</p>
<p>对于完全没有自己行为, 完全只有数据的struct, 我们可以将其视作DTO(Data Transfer Object), 或者叫做一个Bean</p>
<h2 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h2><p>感悟不是很深, 随便记几点:</p>
<ul>
<li>不要传递Null</li>
<li>不要返回Null</li>
<li>用异常机制代替错误码</li>
<li>避免不必要的错误捕捉</li>
</ul>
<h2 id="边界-boundary"><a href="#边界-boundary" class="headerlink" title="边界(boundary)"></a>边界(boundary)</h2><p>边界用于描述一个模块与外部相连的部分, 可以参照类的接口来理解</p>
<ul>
<li><p>对于一个模块提供的过多的并不需要的功能, 我们通过封装来减少第三方代码的边界, 从而降低自己的代码和第三方代码的耦合性, 并且提高可读性, 避免冗余信息</p>
</li>
<li><p>学习探索第三方代码的最佳方式就是test, 自己编写相关功能的测试代码, 来理解各个代码的作用如何. 官方提供的测试用例也是使用代码的良好参考</p>
</li>
<li><p>可以使用不存在的代码, 然后将这些代码编写为一个adapter接口, 再使用第三方代码进行实现, 使我们在选择依赖前先完成自己的设计</p>
</li>
</ul>
<h2 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h2><h3 id="TTD-Test-Driven-Development"><a href="#TTD-Test-Driven-Development" class="headerlink" title="TTD(Test-Driven Development)"></a>TTD(Test-Driven Development)</h3><p>TTD的原则:</p>
<ul>
<li>You may not write production code until you have written a failing unit test.</li>
<li>You may not write more of a unit test than is sufficient to fail, and not compiling is failing.</li>
<li>You may not write more production code than is sufficient to pass the currently failing test.</li>
</ul>
<p>测试使得开发更稳定灵活, 你不必再担心代码改动是否会造成其他部分的故障, 因为test能够限制代码在一定的范围中起作用.</p>
<h3 id="clean-test"><a href="#clean-test" class="headerlink" title="clean test"></a>clean test</h3><p>为了编写简洁的测试, 我们需要将测试需要的数据生成部分单独编写分离, 避免在test函数中编写生成数据的逻辑.</p>
<p>然后, 我们调用需要测试的函数, 并尽量避免在test函数中编写过多的逻辑</p>
<p>最后, 我们使用<strong>一条</strong>断言来判断输出的正确性</p>
<h2 id="Class"><a href="#Class" class="headerlink" title="Class"></a>Class</h2><h3 id="Small-Enough"><a href="#Small-Enough" class="headerlink" title="Small Enough!"></a>Small Enough!</h3><p>类的大小应该足够小, 对于一个类的设计, 我们应该满足SRP(Single Responsibility Principle)</p>
<p>怎样来划分责任取决于设计者的喜好, 但是我们总存在一个普遍认可的指导原则: <strong>高内聚(High Cohesion)</strong></p>
<p>内聚是指类的成员函数和成员变量之间的关系, 如果一个函数能够尽量多地使用成员变量, 那么我们则称为<strong>高内聚</strong>.<br>于是如果一个类的责任过多, 不同的函数之间对变量的使用不可能完全重合, 所以过多的责任将导致类的内聚程度降低, 所以使用<strong>高内聚</strong>的原则来划分类的责任是一个值得参考的方式</p>
<h3 id="Organizing-for-Change"><a href="#Organizing-for-Change" class="headerlink" title="Organizing for Change"></a>Organizing for Change</h3><p>将代码变化部分和不变部分分离, 形成继承结构, 从而满足OCP(Open Closed Principle)</p>
<p>开闭原则指的是, <strong>开放扩展, 关闭修改</strong>.</p>
<p>当我们需要扩展功能时, 通过继承就能实现, 而不改变已有部分</p>
<p>使用接口是对于Change处理的极端情况, 我们将不变部分设置为接口, 我们的扩展行为是对接口的实现. 而使用接口的部分不需要进行修改.</p>
<h2 id="System"><a href="#System" class="headerlink" title="System"></a>System</h2><p>构建系统和使用系统是两个事情, 我们应该将其分开, 其中的一种实现方式叫做DI(dependency injection)</p>
<h3 id="依赖注入"><a href="#依赖注入" class="headerlink" title="依赖注入"></a>依赖注入</h3><p>我们构建一个服务时需要使用很多额外的工具和依赖, 我们需要创建这些依赖并配置它们, 然后使用它们.</p>
<p>依赖注入的思想就是将创建和配置的过程交给其他类来负责, 服务中只需要使用传递进来的完成的依赖的对象即可, 然后在服务中直接使用.</p>
<h3 id="Ioc"><a href="#Ioc" class="headerlink" title="Ioc"></a>Ioc</h3><p>IoC(Inversion of Control)是一种设计思想, 即把程序的某一部分的控制抽取出来, 让外界来负责这一部分的职责.<br>依赖注入是控制反转的一种具体实现, 将程序的依赖反转给了外部来实现.</p>
<h3 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h3><p>AOP(Aspect Oriented Programming)是一种编程思想, 我们的程序运行中存在许多固定的phrase, 这些共同的phrase我们可以看作一个切面, 然后我们通过某些方式将代码加入到切面的某个位置, 从而实现在所有相同的阶段来进行某个操作, 比如记录日志等</p>
<h3 id="Test-drive-the-Archithecture"><a href="#Test-drive-the-Archithecture" class="headerlink" title="Test drive the Archithecture"></a>Test drive the Archithecture</h3><p>我们先编写测试, 而在架构上偏向于使用高度解耦但是简单且原生的方式来实现, 然后在测试中不断优化, 增加功能, 最后实现稳定可靠的系统</p>
<h3 id="做出更好的决定"><a href="#做出更好的决定" class="headerlink" title="做出更好的决定"></a>做出更好的决定</h3><p>做决定时, 将决定权分散(去中心化)能够更好的保证决定的正确性, 并且应当将决定放到不得不做时再决定, 此时你才拥有最多的信息来判断决定的正确性</p>
<h3 id="理性对待标准"><a href="#理性对待标准" class="headerlink" title="理性对待标准"></a>理性对待<em>标准</em></h3><p>对于所谓的行业标准或者编码标准, 只有当你能明确其带来的价值时, 才去采用它, 否则只是无故的增加工作的难度和员工犯错的可能性</p>
<h3 id="使用DSL-Domain-Specific-Language"><a href="#使用DSL-Domain-Specific-Language" class="headerlink" title="使用DSL(Domain Specific Language)"></a>使用DSL(Domain Specific Language)</h3><p>领域特定语言是对应领域的描述方式, 某个领域的专家更偏向于使用的专业语言. </p>
<p>如果我们在代码中使用这样的语言来表达, 可以更好的减少代码对于领域特定实现的错误</p>
<hr>
<h2 id="Emergence"><a href="#Emergence" class="headerlink" title="Emergence"></a>Emergence</h2><p>涌现(emergence)如同字面意思一样, 不同的元素如同泉水一般一点点从泉眼中出现, 量少而连续不断</p>
<h3 id="Emergent-Design"><a href="#Emergent-Design" class="headerlink" title="Emergent Design"></a>Emergent Design</h3><p>涌现式设计就是这种形式的一种体现, 我们会源源不断地产生新的想法和方案, 然后将这些想法一一付诸实践. 但是这势必会造成现有系统的不断更改, 从而造成无用工作. 所以对于涌现式设计, 我们需要在项目建立之时就采用灵活且低耦合的设计方式, 然后不断地将想法融入其中.</p>
<p>为了实现涌现式设计, 我们需要遵守以下原则:</p>
<ul>
<li><p>编写好完整地测试</p>
<p>编写好了完整地测试后, 我们就可以自由地修改现有程序, 而保证我们的修改没有破坏原本的程序</p>
</li>
<li><p>Refactory(重构)</p>
<p>完成了测试后, 我们需要不断地重构代码, 具体包括如下;</p>
<ul>
<li>消除重复代码</li>
<li>优化代码表达性</li>
<li>最小化类和方法</li>
</ul>
</li>
</ul>
<h2 id="Concurrency"><a href="#Concurrency" class="headerlink" title="Concurrency"></a>Concurrency</h2><p>并发从来都是一个提高程序性能但是难以把控的问题.</p>
<p>简单回顾一下引发死锁的四个必要条件:</p>
<ul>
<li>互斥条件: 一个资源每次只能被一个进程使用</li>
<li>请求与保持条件: 一个进程因请求资源而阻塞时, 对已获得的资源保持不放</li>
<li>不剥夺条件: 进程已获得的资源, 在末使用完之前, 不能强行剥夺</li>
<li>循环等待条件: 若干进程之间形成一种头尾相接的循环等待资源关系</li>
</ul>
<h3 id="SRP-in-Conccurrency"><a href="#SRP-in-Conccurrency" class="headerlink" title="SRP in Conccurrency"></a>SRP in Conccurrency</h3><p>由于并发代码的复杂性, 并且其拥有单独的错误和调试方式, 所以我们应当将并发代码视作单独的责任, 尽管它属于功能的一部分.</p>
<h3 id="减少共享数据-缩小数据scope"><a href="#减少共享数据-缩小数据scope" class="headerlink" title="减少共享数据, 缩小数据scope"></a>减少共享数据, 缩小数据scope</h3><p>数据一致性问题是并发编程面对的主要挑战之一, 所以为了减少shared data带来的问题, 我们偏好于减少共享数据的采用.</p>
<p>其中一种解决方式是通过拷贝原始数据到多个threads中, 然后在完成后将各自的结果合并.</p>
<h3 id="尽量独立"><a href="#尽量独立" class="headerlink" title="尽量独立"></a>尽量独立</h3><p>线程进行的任务应该尽量的独立, 而不依靠其他线程, 这样可以减少条件变量和线程之间的依赖, 降低系统复杂度, 从而减少问题的产生.</p>
<h3 id="Excution-Models"><a href="#Excution-Models" class="headerlink" title="Excution Models"></a>Excution Models</h3><h4 id="Produceer-Consumer"><a href="#Produceer-Consumer" class="headerlink" title="Produceer-Consumer"></a>Produceer-Consumer</h4><p>生产者消费者模型, 很常见</p>
<h4 id="Readers-Writers"><a href="#Readers-Writers" class="headerlink" title="Readers-Writers"></a>Readers-Writers</h4><p>读写锁相关的模型</p>
<h4 id="Dining-Philosophers"><a href="#Dining-Philosophers" class="headerlink" title="Dining Philosophers"></a>Dining Philosophers</h4><p>多个消耗资源的对象和多个资源构成的模型.</p>
<h3 id="Synchronized-Method"><a href="#Synchronized-Method" class="headerlink" title="Synchronized Method"></a>Synchronized Method</h3><p>使用<code>Synchronized</code>修饰的方法可以保证内部的原子性, 但是需要注意多个方法之间的并发问题</p>
<hr>
<h1 id="第三部分"><a href="#第三部分" class="headerlink" title="第三部分"></a>第三部分</h1><p>第三部分是关于工程实践, 略过<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css"></p>

</div>

<div id="paginator">
  
</div>

<script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
  mermaid.initialize({
    securityLevel: 'loose',
    theme: 'forest',
  });
</script>


<!-- scripts list from theme config.yml -->

<script src="/js/post/mermaid.js"></script>


    </div>

  </div>



  
  <!-- scripts list from theme config.yml -->
  
  <script src="/js/layout/animation.js"></script>
  
  <script src="/js/layout/svg.js"></script>
  
  <script src="/js/csstool.js"></script>
  
  

</body>

</html>