import{_ as n}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as s,c as a,e}from"./app-DCTCPPGQ.js";const p={},o=e(`<h1 id="内存空间" tabindex="-1"><a class="header-anchor" href="#内存空间"><span>内存空间</span></a></h1><ul><li><p>早期计算机的内存空间 早期计算机只需要运行一个程序，所以内存结构为：</p><ul><li>头部为操作系统所用的内存</li><li>后半部分为单个程序所用的部分</li></ul></li><li><p>多程序计算机的内存空间 此时的内存空间如下：</p><ul><li>操作系统依然占据头部</li><li>多个进程占用剩下的部分，并且每个进程有一个区域的划分</li><li>会有多出来的区域未被进程使用</li></ul></li><li><p>内存地址 为了方便程序员访问内存中指定的地址，我们使用内存地址对内存进行访问，但是值得注意的是，内存地址分为逻辑地址和物理地址，逻辑地址是程序员访问内存的地址，而物理地址是内存中实际的地址，两个地址之间是映射关系，需要通过地址转换来实现，具体的实现细节分页等原理在CSAPP中内存部分提及</p></li><li><p>进程的内存 书上构建了一个简单的模型：</p><ul><li>进程的内存头部为Progarm code</li><li>然后紧跟着是堆（Heap）部分，其大小向下增加（地址变大）</li><li>内存底部是栈（Stack）部分，其大小向上增加（地址变小）</li></ul></li><li><p>内存虚拟化 为了能让不同的进程拥有独立安全的内存空间，并且能够方便的连续访问，我们对物理内存进行了虚拟化，交由OS进行控制管理 内存虚拟化需要考虑以下的问题：</p><ul><li><p>透明性 透明性的意思是指，进程并不知道自己所用的内存空间是虚拟化的，只需要单独考虑自己空间的使用即可，而操作系统负责将进程认为的“物理地址”转化为真正的物理内存的地址</p></li><li><p>高效性 为了让OS能够在管理查询内存时的高效性，我们会用到一些需要硬件支持的技术，比如TLB等</p></li><li><p>保护性 为了保证进程的安全性，我们需要对进程的内存空间进行保护，比如只读，只写等，以及如何让进程访问内存的权限进行控制</p></li></ul></li><li><p>进程的内存分类</p><ul><li>堆（Heap） 堆是进程中动态分配的内存空间</li><li>栈（Stack） 栈在程序的编译阶段就已经完成了分配，由编译器来处理分配的大小顺序等 具体的栈的原理在CSAPP中已经详细学过，如果有更多的内容再单独记录</li></ul></li></ul><hr><h2 id="homework" tabindex="-1"><a class="header-anchor" href="#homework"><span>Homework</span></a></h2><p>作业部分没有什么值得注意的，只简要记录一下 <code>pmap</code>的使用方法：</p><p>当我们输入<code>pmap -X</code>指令获取一个进程的内存后，终端显示如下:</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>dnull@DESKTOP-0ACA874:/mnt/d/this/linuxtemp$ pmap <span class="token parameter variable">-X</span> <span class="token number">9</span>
<span class="token number">9</span>:   <span class="token parameter variable">-bash</span>
     Address Perm   Offset Device Inode Size  Rss  Pss Referenced Anonymous LazyFree ShmemPmdMapped FilePmdMapped Shared_Hugetlb Private_Hugetlb Swap SwapPss Locked THPeligible Mapping
<span class="token number">560749578000</span> r--p 00000000  08:20  <span class="token number">1241</span>  <span class="token number">188</span>  <span class="token number">188</span>  <span class="token number">188</span>        <span class="token number">188</span>         <span class="token number">0</span>        <span class="token number">0</span>              <span class="token number">0</span>             <span class="token number">0</span>              <span class="token number">0</span>               <span class="token number">0</span>    <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span>           <span class="token number">0</span> <span class="token function">bash</span>
5607495a7000 r-xp 0002f000  08:20  <span class="token number">1241</span>  <span class="token number">892</span>  <span class="token number">884</span>  <span class="token number">884</span>        <span class="token number">884</span>         <span class="token number">0</span>        <span class="token number">0</span>              <span class="token number">0</span>             <span class="token number">0</span>              <span class="token number">0</span>               <span class="token number">0</span>    <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span>           <span class="token number">0</span> <span class="token function">bash</span>
<span class="token number">560749686000</span> r--p 0010e000  08:20  <span class="token number">1241</span>  <span class="token number">232</span>  <span class="token number">104</span>  <span class="token number">104</span>        <span class="token number">104</span>         <span class="token number">0</span>        <span class="token number">0</span>              <span class="token number">0</span>             <span class="token number">0</span>              <span class="token number">0</span>               <span class="token number">0</span>    <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span>           <span class="token number">0</span> <span class="token function">bash</span>
5607496c1000 r--p 00148000  08:20  <span class="token number">1241</span>   <span class="token number">16</span>   <span class="token number">16</span>   <span class="token number">16</span>         <span class="token number">16</span>        <span class="token number">16</span>        <span class="token number">0</span>              <span class="token number">0</span>             <span class="token number">0</span>              <span class="token number">0</span>               <span class="token number">0</span>    <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span>           <span class="token number">0</span> <span class="token function">bash</span>
5607496c5000 rw-p 0014c000  08:20  <span class="token number">1241</span>   <span class="token number">36</span>   <span class="token number">36</span>   <span class="token number">36</span>         <span class="token number">36</span>        <span class="token number">36</span>        <span class="token number">0</span>              <span class="token number">0</span>             <span class="token number">0</span>              <span class="token number">0</span>               <span class="token number">0</span>    <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span>           <span class="token number">0</span> <span class="token function">bash</span>
5607496ce000 rw-p 00000000  00:00     <span class="token number">0</span>   <span class="token number">44</span>   <span class="token number">28</span>   <span class="token number">28</span>         <span class="token number">28</span>        <span class="token number">28</span>        <span class="token number">0</span>              <span class="token number">0</span>             <span class="token number">0</span>              <span class="token number">0</span>               <span class="token number">0</span>    <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span>           <span class="token number">0</span>
56074a1df000 rw-p 00000000  00:00     <span class="token number">0</span> <span class="token number">1560</span> <span class="token number">1432</span> <span class="token number">1432</span>       <span class="token number">1432</span>      <span class="token number">1432</span>        <span class="token number">0</span>              <span class="token number">0</span>             <span class="token number">0</span>              <span class="token number">0</span>               <span class="token number">0</span>    <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span>           <span class="token number">0</span> <span class="token punctuation">[</span>heap<span class="token punctuation">]</span>
7f45f6ae2000 r--p 00000000  08:20  <span class="token number">2331</span>  <span class="token number">348</span>  <span class="token number">128</span>   <span class="token number">66</span>        <span class="token number">128</span>         <span class="token number">0</span>        <span class="token number">0</span>              <span class="token number">0</span>             <span class="token number">0</span>              <span class="token number">0</span>               <span class="token number">0</span>    <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span>           <span class="token number">0</span> LC_CTYPE
7f45f6b39000 r--p 00000000  08:20  <span class="token number">2338</span>    <span class="token number">4</span>    <span class="token number">4</span>    <span class="token number">2</span>          <span class="token number">4</span>         <span class="token number">0</span>        <span class="token number">0</span>              <span class="token number">0</span>             <span class="token number">0</span>              <span class="token number">0</span>               <span class="token number">0</span>    <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span>           <span class="token number">0</span> <span class="token environment constant">LC_NUMERIC</span>
7f45f6b3a000 r--p 00000000  08:20  <span class="token number">2341</span>    <span class="token number">4</span>    <span class="token number">4</span>    <span class="token number">2</span>          <span class="token number">4</span>         <span class="token number">0</span>        <span class="token number">0</span>              <span class="token number">0</span>             <span class="token number">0</span>              <span class="token number">0</span>               <span class="token number">0</span>    <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span>           <span class="token number">0</span> <span class="token environment constant">LC_TIME</span>
7f45f6b3b000 r--p 00000000  08:20  <span class="token number">2330</span>    <span class="token number">4</span>    <span class="token number">4</span>    <span class="token number">2</span>          <span class="token number">4</span>         <span class="token number">0</span>        <span class="token number">0</span>              <span class="token number">0</span>             <span class="token number">0</span>              <span class="token number">0</span>               <span class="token number">0</span>    <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span>           <span class="token number">0</span> LC_COLLATE
7f45f6b3c000 r--p 00000000  08:20  <span class="token number">2336</span>    <span class="token number">4</span>    <span class="token number">4</span>    <span class="token number">2</span>          <span class="token number">4</span>         <span class="token number">0</span>        <span class="token number">0</span>              <span class="token number">0</span>             <span class="token number">0</span>              <span class="token number">0</span>               <span class="token number">0</span>    <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span>           <span class="token number">0</span> <span class="token environment constant">LC_MONETARY</span>
7f45f6b3d000 r--p 00000000  08:20  <span class="token number">2335</span>    <span class="token number">4</span>    <span class="token number">4</span>    <span class="token number">2</span>          <span class="token number">4</span>         <span class="token number">0</span>        <span class="token number">0</span>              <span class="token number">0</span>             <span class="token number">0</span>              <span class="token number">0</span>               <span class="token number">0</span>    <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span>           <span class="token number">0</span> SYS_LC_MESSAGES
7f45f6b3e000 r--s 00000000  08:20  <span class="token number">6259</span>   <span class="token number">28</span>   <span class="token number">28</span>   <span class="token number">14</span>         <span class="token number">28</span>         <span class="token number">0</span>        <span class="token number">0</span>              <span class="token number">0</span>             <span class="token number">0</span>              <span class="token number">0</span>               <span class="token number">0</span>    <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span>           <span class="token number">0</span> gconv-modules.cache
7f45f6b45000 rw-p 00000000  00:00     <span class="token number">0</span>   <span class="token number">12</span>    <span class="token number">8</span>    <span class="token number">8</span>          <span class="token number">8</span>         <span class="token number">8</span>        <span class="token number">0</span>              <span class="token number">0</span>             <span class="token number">0</span>              <span class="token number">0</span>               <span class="token number">0</span>    <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span>           <span class="token number">0</span>
7f45f6b48000 r--p 00000000  08:20  <span class="token number">6488</span>  <span class="token number">160</span>  <span class="token number">160</span>   <span class="token number">80</span>        <span class="token number">160</span>         <span class="token number">0</span>        <span class="token number">0</span>              <span class="token number">0</span>             <span class="token number">0</span>              <span class="token number">0</span>               <span class="token number">0</span>    <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span>           <span class="token number">0</span> libc.so.6
7f45f6b70000 r-xp 00028000  08:20  <span class="token number">6488</span> <span class="token number">1620</span> <span class="token number">1220</span>  <span class="token number">712</span>       <span class="token number">1220</span>         <span class="token number">0</span>        <span class="token number">0</span>              <span class="token number">0</span>             <span class="token number">0</span>              <span class="token number">0</span>               <span class="token number">0</span>    <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span>           <span class="token number">0</span> libc.so.6
7f45f6d05000 r--p 001bd000  08:20  <span class="token number">6488</span>  <span class="token number">352</span>  <span class="token number">152</span>   <span class="token number">82</span>        <span class="token number">152</span>         <span class="token number">0</span>        <span class="token number">0</span>              <span class="token number">0</span>             <span class="token number">0</span>              <span class="token number">0</span>               <span class="token number">0</span>    <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span>           <span class="token number">0</span> libc.so.6
7f45f6d5d000 r--p 00214000  08:20  <span class="token number">6488</span>   <span class="token number">16</span>   <span class="token number">16</span>   <span class="token number">16</span>         <span class="token number">16</span>        <span class="token number">16</span>        <span class="token number">0</span>              <span class="token number">0</span>             <span class="token number">0</span>              <span class="token number">0</span>               <span class="token number">0</span>    <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span>           <span class="token number">0</span> libc.so.6
7f45f6d61000 rw-p 00218000  08:20  <span class="token number">6488</span>    <span class="token number">8</span>    <span class="token number">8</span>    <span class="token number">8</span>          <span class="token number">8</span>         <span class="token number">8</span>        <span class="token number">0</span>              <span class="token number">0</span>             <span class="token number">0</span>              <span class="token number">0</span>               <span class="token number">0</span>    <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span>           <span class="token number">0</span> libc.so.6
7f45f6d63000 rw-p 00000000  00:00     <span class="token number">0</span>   <span class="token number">52</span>   <span class="token number">24</span>   <span class="token number">24</span>         <span class="token number">24</span>        <span class="token number">24</span>        <span class="token number">0</span>              <span class="token number">0</span>             <span class="token number">0</span>              <span class="token number">0</span>               <span class="token number">0</span>    <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span>           <span class="token number">0</span>
7f45f6d70000 r--p 00000000  08:20  <span class="token number">6805</span>   <span class="token number">56</span>   <span class="token number">56</span>   <span class="token number">56</span>         <span class="token number">56</span>         <span class="token number">0</span>        <span class="token number">0</span>              <span class="token number">0</span>             <span class="token number">0</span>              <span class="token number">0</span>               <span class="token number">0</span>    <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span>           <span class="token number">0</span> libtinfo.so.6.3
7f45f6d7e000 r-xp 0000e000  08:20  <span class="token number">6805</span>   <span class="token number">68</span>   <span class="token number">64</span>   <span class="token number">64</span>         <span class="token number">64</span>         <span class="token number">0</span>        <span class="token number">0</span>              <span class="token number">0</span>             <span class="token number">0</span>              <span class="token number">0</span>               <span class="token number">0</span>    <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span>           <span class="token number">0</span> libtinfo.so.6.3
7f45f6d8f000 r--p 0001f000  08:20  <span class="token number">6805</span>   <span class="token number">56</span>   <span class="token number">52</span>   <span class="token number">52</span>         <span class="token number">52</span>         <span class="token number">0</span>        <span class="token number">0</span>              <span class="token number">0</span>             <span class="token number">0</span>              <span class="token number">0</span>               <span class="token number">0</span>    <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span>           <span class="token number">0</span> libtinfo.so.6.3
7f45f6d9d000 r--p 0002c000  08:20  <span class="token number">6805</span>   <span class="token number">16</span>   <span class="token number">16</span>   <span class="token number">16</span>         <span class="token number">16</span>        <span class="token number">16</span>        <span class="token number">0</span>              <span class="token number">0</span>             <span class="token number">0</span>              <span class="token number">0</span>               <span class="token number">0</span>    <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span>           <span class="token number">0</span> libtinfo.so.6.3
7f45f6da1000 rw-p 00030000  08:20  <span class="token number">6805</span>    <span class="token number">4</span>    <span class="token number">4</span>    <span class="token number">4</span>          <span class="token number">4</span>         <span class="token number">4</span>        <span class="token number">0</span>              <span class="token number">0</span>             <span class="token number">0</span>              <span class="token number">0</span>               <span class="token number">0</span>    <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span>           <span class="token number">0</span> libtinfo.so.6.3
7f45f6da2000 r--p 00000000  08:20  <span class="token number">2339</span>    <span class="token number">4</span>    <span class="token number">4</span>    <span class="token number">2</span>          <span class="token number">4</span>         <span class="token number">0</span>        <span class="token number">0</span>              <span class="token number">0</span>             <span class="token number">0</span>              <span class="token number">0</span>               <span class="token number">0</span>    <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span>           <span class="token number">0</span> <span class="token environment constant">LC_PAPER</span>
7f45f6da3000 r--p 00000000  08:20  <span class="token number">2337</span>    <span class="token number">4</span>    <span class="token number">4</span>    <span class="token number">2</span>          <span class="token number">4</span>         <span class="token number">0</span>        <span class="token number">0</span>              <span class="token number">0</span>             <span class="token number">0</span>              <span class="token number">0</span>               <span class="token number">0</span>    <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span>           <span class="token number">0</span> <span class="token environment constant">LC_NAME</span>
7f45f6da4000 r--p 00000000  08:20  <span class="token number">2329</span>    <span class="token number">4</span>    <span class="token number">4</span>    <span class="token number">2</span>          <span class="token number">4</span>         <span class="token number">0</span>        <span class="token number">0</span>              <span class="token number">0</span>             <span class="token number">0</span>              <span class="token number">0</span>               <span class="token number">0</span>    <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span>           <span class="token number">0</span> <span class="token environment constant">LC_ADDRESS</span>
7f45f6da5000 r--p 00000000  08:20  <span class="token number">2340</span>    <span class="token number">4</span>    <span class="token number">4</span>    <span class="token number">2</span>          <span class="token number">4</span>         <span class="token number">0</span>        <span class="token number">0</span>              <span class="token number">0</span>             <span class="token number">0</span>              <span class="token number">0</span>               <span class="token number">0</span>    <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span>           <span class="token number">0</span> <span class="token environment constant">LC_TELEPHONE</span>
7f45f6da6000 r--p 00000000  08:20  <span class="token number">2333</span>    <span class="token number">4</span>    <span class="token number">4</span>    <span class="token number">2</span>          <span class="token number">4</span>         <span class="token number">0</span>        <span class="token number">0</span>              <span class="token number">0</span>             <span class="token number">0</span>              <span class="token number">0</span>               <span class="token number">0</span>    <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span>           <span class="token number">0</span> <span class="token environment constant">LC_MEASUREMENT</span>
7f45f6da7000 rw-p 00000000  00:00     <span class="token number">0</span>    <span class="token number">8</span>    <span class="token number">8</span>    <span class="token number">8</span>          <span class="token number">8</span>         <span class="token number">8</span>        <span class="token number">0</span>              <span class="token number">0</span>             <span class="token number">0</span>              <span class="token number">0</span>               <span class="token number">0</span>    <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span>           <span class="token number">0</span>
7f45f6da9000 r--p 00000000  08:20  <span class="token number">6292</span>    <span class="token number">8</span>    <span class="token number">8</span>    <span class="token number">4</span>          <span class="token number">8</span>         <span class="token number">0</span>        <span class="token number">0</span>              <span class="token number">0</span>             <span class="token number">0</span>              <span class="token number">0</span>               <span class="token number">0</span>    <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span>           <span class="token number">0</span> ld-linux-x86-64.so.2
7f45f6dab000 r-xp 00002000  08:20  <span class="token number">6292</span>  <span class="token number">168</span>  <span class="token number">168</span>   <span class="token number">84</span>        <span class="token number">168</span>         <span class="token number">0</span>        <span class="token number">0</span>              <span class="token number">0</span>             <span class="token number">0</span>              <span class="token number">0</span>               <span class="token number">0</span>    <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span>           <span class="token number">0</span> ld-linux-x86-64.so.2
7f45f6dd5000 r--p 0002c000  08:20  <span class="token number">6292</span>   <span class="token number">44</span>   <span class="token number">40</span>   <span class="token number">20</span>         <span class="token number">40</span>         <span class="token number">0</span>        <span class="token number">0</span>              <span class="token number">0</span>             <span class="token number">0</span>              <span class="token number">0</span>               <span class="token number">0</span>    <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span>           <span class="token number">0</span> ld-linux-x86-64.so.2
7f45f6de0000 r--p 00000000  08:20  <span class="token number">2332</span>    <span class="token number">4</span>    <span class="token number">4</span>    <span class="token number">2</span>          <span class="token number">4</span>         <span class="token number">0</span>        <span class="token number">0</span>              <span class="token number">0</span>             <span class="token number">0</span>              <span class="token number">0</span>               <span class="token number">0</span>    <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span>           <span class="token number">0</span> <span class="token environment constant">LC_IDENTIFICATION</span>
7f45f6de1000 r--p 00037000  08:20  <span class="token number">6292</span>    <span class="token number">8</span>    <span class="token number">8</span>    <span class="token number">8</span>          <span class="token number">8</span>         <span class="token number">8</span>        <span class="token number">0</span>              <span class="token number">0</span>             <span class="token number">0</span>              <span class="token number">0</span>               <span class="token number">0</span>    <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span>           <span class="token number">0</span> ld-linux-x86-64.so.2
7f45f6de3000 rw-p 00039000  08:20  <span class="token number">6292</span>    <span class="token number">8</span>    <span class="token number">8</span>    <span class="token number">8</span>          <span class="token number">8</span>         <span class="token number">8</span>        <span class="token number">0</span>              <span class="token number">0</span>             <span class="token number">0</span>              <span class="token number">0</span>               <span class="token number">0</span>    <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span>           <span class="token number">0</span> ld-linux-x86-64.so.2
7ffc82ecf000 rw-p 00000000  00:00     <span class="token number">0</span>  <span class="token number">132</span>  <span class="token number">112</span>  <span class="token number">112</span>        <span class="token number">112</span>       <span class="token number">112</span>        <span class="token number">0</span>              <span class="token number">0</span>             <span class="token number">0</span>              <span class="token number">0</span>               <span class="token number">0</span>    <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span>           <span class="token number">0</span> <span class="token punctuation">[</span>stack<span class="token punctuation">]</span>
7ffc82eff000 r--p 00000000  00:00     <span class="token number">0</span>   <span class="token number">16</span>    <span class="token number">0</span>    <span class="token number">0</span>          <span class="token number">0</span>         <span class="token number">0</span>        <span class="token number">0</span>              <span class="token number">0</span>             <span class="token number">0</span>              <span class="token number">0</span>               <span class="token number">0</span>    <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span>           <span class="token number">0</span> <span class="token punctuation">[</span>vvar<span class="token punctuation">]</span>
7ffc82f03000 r-xp 00000000  00:00     <span class="token number">0</span>    <span class="token number">4</span>    <span class="token number">4</span>    <span class="token number">0</span>          <span class="token number">4</span>         <span class="token number">0</span>        <span class="token number">0</span>              <span class="token number">0</span>             <span class="token number">0</span>              <span class="token number">0</span>               <span class="token number">0</span>    <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span>           <span class="token number">0</span> <span class="token punctuation">[</span>vdso<span class="token punctuation">]</span>
                                        <span class="token operator">==</span><span class="token operator">==</span> <span class="token operator">==</span><span class="token operator">==</span> <span class="token operator">==</span><span class="token operator">==</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> <span class="token operator">==</span><span class="token operator">==</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
                                        <span class="token number">6204</span> <span class="token number">5024</span> <span class="token number">4156</span>       <span class="token number">5024</span>      <span class="token number">1724</span>        <span class="token number">0</span>              <span class="token number">0</span>             <span class="token number">0</span>              <span class="token number">0</span>               <span class="token number">0</span>    <span class="token number">0</span>       <span class="token number">0</span>      <span class="token number">0</span>           <span class="token number">0</span> KB
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们发现进程运行的地址为<code>0x7f45f6d7e000</code>这样的地址，但是我们在CSAPP中学习时的汇编程序的入口点都是 <code>0x400000</code>这样的地址，这是因为我们编译时生成的是位置无关代码，的实际地址是OS的大内存空间中选一个基址，然后通过偏移计算出来的</p><p>我们可以在编译时加上<code>-no-pie</code>参数，这样就会生成位置相关代码了，代码就会被强制加载到<code>0x400000</code>这样的地址，但是这样做很有可能导致程序无法运行，原因如下：</p><ul><li>位置相关代码的入口点是固定的，如果这个入口点被其他程序占用，可能导致程序的运行错误，具体的表现和操作系统的类型有关</li></ul><hr><p>由于第一章内容太少，就和第二章一起说了</p><h1 id="第二章-内存的api" tabindex="-1"><a class="header-anchor" href="#第二章-内存的api"><span>第二章 内存的API</span></a></h1><p>这一章主要介绍了内存管理的两个主要API，<code>malloc</code>和<code>free</code>，以及一些内存管理的相关知识</p><ul><li><code>malloc(size_t size)</code>：分配一块大小为<code>size</code>的内存空间，返回指向这块内存空间的指针，如果分配失败，返回<code>NULL</code></li><li><code>free(void *ptr)</code>：释放<code>ptr</code>指向的内存空间，如果<code>ptr</code>为<code>NULL</code>，则不做任何操作</li></ul><p>通过<code>malloc</code>和<code>free</code>，我们可以对堆内存部分进行分配和释放</p><p>这部分作为程序基础已经在很多地方都已经学习过了，所以我们记录一下书上提到的关于内存的一些常见错误：</p><ul><li><p>forget to allocate memory 没有给一个指针分配内存就使用，如果该指针为局部变量，由于储存在栈中，其具体值并不确定，如果储存在BSS（Block Started by Symbol）中，其指针为0</p></li><li><p>not allocating enough memory 没有给一个数组之类的对象分配足够的内存导致越界</p></li><li><p>forgetting to initialize memory 给指针分配内存后没有初始化导致数据错误，我们的指针分配的内存位于堆内存，可能有之前的数据残留，所以不初始化可能得到一个未知的数值</p></li><li><p>forgetting to free memory 不释放内存将导致内存泄漏，使得可用内存空间不足</p></li><li><p>free memory before you are done with it 释放一个还在使用中的内存，在之后将无法再访问这个内存空间，造成段错误</p></li><li><p>free memory twice 释放一个已经释放的内存，这样会导致程序崩溃</p></li></ul><h2 id="os对内存操作的支持" tabindex="-1"><a class="header-anchor" href="#os对内存操作的支持"><span>OS对内存操作的支持</span></a></h2><p>我们提到的<code>malloc()</code>和<code>free()</code>都是C语言的标准库函数，而不是系统调用，这些库函数的实现中用到了包括<code>brk()</code>和<code>sbrk()</code>在内的系统调用，这些系统调用并不推荐被使用，因为容易导致错误</p><p>此外还有一个方法<code>mmap()</code>，它可以将文件映射到内存中，这样就可以直接对文件进行读写操作，而不需要通过系统调用<code>read()</code>和<code>write()</code>。通过<code>mmap()</code>，可以实现外部排序等问题（在内存空间外对大数据文件进行操作排序等）</p><ul><li><p>一些其他的方法</p><ul><li><code>calloc()</code>：这种申请内存的方法会把申请的空间初始化为0</li><li><code>ralloc()</code>：这个申请方式则会拷贝一个已经分配的内存空间中的值，然后申请一个更大的空间，并将值拷贝其中</li></ul></li><li><p>关于linux上检测内存泄漏的工具：<strong>valgrind</strong> 使用指令为：<code>valgrind --leak-check=full ./a.out</code> 后面的启动程序要要使用<code>./</code>启动</p></li></ul>`,22),l=[o];function t(r,c){return s(),a("div",null,l)}const k=n(p,[["render",t],["__file","CH1-2-Memoryspace.html.vue"]]),b=JSON.parse(`{"path":"/posts/operating-system/ostep/CH1-2-Memoryspace.html","title":"内存空间","lang":"zh-CN","frontmatter":{"date":"2021-01-01T00:00:00.000Z","title":"内存空间","tag":["operating-system","计算机系统","内存空间","内存虚拟化","内存地址"],"categories":["操作系统","Three-Easy-Pieces"],"math":true,"description":"内存空间 早期计算机的内存空间 早期计算机只需要运行一个程序，所以内存结构为： 头部为操作系统所用的内存 后半部分为单个程序所用的部分 多程序计算机的内存空间 此时的内存空间如下： 操作系统依然占据头部 多个进程占用剩下的部分，并且每个进程有一个区域的划分 会有多出来的区域未被进程使用 内存地址 为了方便程序员访问内存中指定的地址，我们使用内存地址对内...","head":[["meta",{"property":"og:url","content":"https://Dnullp.github.io/posts/operating-system/ostep/CH1-2-Memoryspace.html"}],["meta",{"property":"og:site_name","content":"Dnull's Blog"}],["meta",{"property":"og:title","content":"内存空间"}],["meta",{"property":"og:description","content":"内存空间 早期计算机的内存空间 早期计算机只需要运行一个程序，所以内存结构为： 头部为操作系统所用的内存 后半部分为单个程序所用的部分 多程序计算机的内存空间 此时的内存空间如下： 操作系统依然占据头部 多个进程占用剩下的部分，并且每个进程有一个区域的划分 会有多出来的区域未被进程使用 内存地址 为了方便程序员访问内存中指定的地址，我们使用内存地址对内..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-04-14T13:35:40.000Z"}],["meta",{"property":"article:author","content":"Dnull"}],["meta",{"property":"article:tag","content":"operating-system"}],["meta",{"property":"article:tag","content":"计算机系统"}],["meta",{"property":"article:tag","content":"内存空间"}],["meta",{"property":"article:tag","content":"内存虚拟化"}],["meta",{"property":"article:tag","content":"内存地址"}],["meta",{"property":"article:published_time","content":"2021-01-01T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-04-14T13:35:40.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"内存空间\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2021-01-01T00:00:00.000Z\\",\\"dateModified\\":\\"2024-04-14T13:35:40.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Dnull\\",\\"url\\":\\"https://Dnullp.github.io\\"}]}"]]},"headers":[{"level":2,"title":"Homework","slug":"homework","link":"#homework","children":[]},{"level":2,"title":"OS对内存操作的支持","slug":"os对内存操作的支持","link":"#os对内存操作的支持","children":[]}],"git":{"createdTime":1712936892000,"updatedTime":1713101740000,"contributors":[{"name":"DnullP","email":"dnull123p@gmail.com","commits":2}]},"readingTime":{"minutes":8.75,"words":2625},"filePathRelative":"posts/operating-system/ostep/CH1-2-Memoryspace.md","localizedDate":"2021年1月1日","excerpt":"\\n<ul>\\n<li>\\n<p>早期计算机的内存空间\\n早期计算机只需要运行一个程序，所以内存结构为：</p>\\n<ul>\\n<li>头部为操作系统所用的内存</li>\\n<li>后半部分为单个程序所用的部分</li>\\n</ul>\\n</li>\\n<li>\\n<p>多程序计算机的内存空间\\n此时的内存空间如下：</p>\\n<ul>\\n<li>操作系统依然占据头部</li>\\n<li>多个进程占用剩下的部分，并且每个进程有一个区域的划分</li>\\n<li>会有多出来的区域未被进程使用</li>\\n</ul>\\n</li>\\n<li>\\n<p>内存地址\\n为了方便程序员访问内存中指定的地址，我们使用内存地址对内存进行访问，但是值得注意的是，内存地址分为逻辑地址和物理地址，逻辑地址是程序员访问内存的地址，而物理地址是内存中实际的地址，两个地址之间是映射关系，需要通过地址转换来实现，具体的实现细节分页等原理在CSAPP中内存部分提及</p>\\n</li>\\n<li>\\n<p>进程的内存\\n书上构建了一个简单的模型：</p>\\n<ul>\\n<li>进程的内存头部为Progarm code</li>\\n<li>然后紧跟着是堆（Heap）部分，其大小向下增加（地址变大）</li>\\n<li>内存底部是栈（Stack）部分，其大小向上增加（地址变小）</li>\\n</ul>\\n</li>\\n<li>\\n<p>内存虚拟化\\n为了能让不同的进程拥有独立安全的内存空间，并且能够方便的连续访问，我们对物理内存进行了虚拟化，交由OS进行控制管理\\n内存虚拟化需要考虑以下的问题：</p>\\n<ul>\\n<li>\\n<p>透明性\\n透明性的意思是指，进程并不知道自己所用的内存空间是虚拟化的，只需要单独考虑自己空间的使用即可，而操作系统负责将进程认为的“物理地址”转化为真正的物理内存的地址</p>\\n</li>\\n<li>\\n<p>高效性\\n为了让OS能够在管理查询内存时的高效性，我们会用到一些需要硬件支持的技术，比如TLB等</p>\\n</li>\\n<li>\\n<p>保护性\\n为了保证进程的安全性，我们需要对进程的内存空间进行保护，比如只读，只写等，以及如何让进程访问内存的权限进行控制</p>\\n</li>\\n</ul>\\n</li>\\n<li>\\n<p>进程的内存分类</p>\\n<ul>\\n<li>堆（Heap）\\n堆是进程中动态分配的内存空间</li>\\n<li>栈（Stack）\\n栈在程序的编译阶段就已经完成了分配，由编译器来处理分配的大小顺序等\\n具体的栈的原理在CSAPP中已经详细学过，如果有更多的内容再单独记录</li>\\n</ul>\\n</li>\\n</ul>","autoDesc":true}`);export{k as comp,b as data};
